{% load staticfiles %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>WebSSH</title>

    <link href="{% static 'css/xterm.css' %}" rel="stylesheet" type="text/css"/>
</head>
<body>
<p style="background-color: #dd4b39 !important;color: #fff !important;">关闭窗口之前请先执行<span
        style="background-color: #ffff00;color: #000000;">exit</span>命令退出服务器！当前使用账号为：<span
        style="background-color: #ffff00;color: #000000;">{{ fort_username }}@{{ server_ip }}</span>
</p>
<div id="terms"></div>
</body>

<script src="{% static 'js/xterm.js' %}"></script>
<script>
    const socket = new WebSocket('ws://' + window.location.host + '/ws/webssh/' + {{ server_id }} +'/' + {{ fort_user_id }} +'/');

    socket.onopen = function () {

        const term = new Terminal({
            rows: 34,
            cols: 128,
            screenKeys: true,
            useStyle: true,
            cursorBlink: true,
        });
        term.open(document.getElementById('terms'));

        term.on('data', function (data) {
            socket.send(data);
        });

        socket.onmessage = function (msg) {
            term.write(msg.data);
        };
        socket.onerror = function (e) {
            alert(e);
        };

        socket.onclose = function () {
            term.destroy();
        };
    };

    window.onbeforeunload = function () {
        return '请确认是否输入了exit命令';
    };

</script>

</html>